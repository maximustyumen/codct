<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><title>OSG/SDL Tutorial 22 - Levels</title>



<link rel="stylesheet" type="text/css" href="levels_files/style.css"></head><body dir="ltr" lang="en-US">
<center>
<table class="main">
<tbody><tr>
<td>
<a href="http://www.cs.clemson.edu/%7Emalloy/courses/3dgames-2007/tutor/index.html"><img src="levels_files/logo1.png" alt="Tutorial Index" border="0"></a>
<h1 class="title">Tutorial 22 - Levels</h1>
<hr>
<!--/////////////////////////////////////////////////////////////////////////-->
<p class="subtitle">Introduction</p>
<p class="body">
    In this tutorial we will demonstrate one way to add multiple levels to your
game engine, each containing different game objects.
</p>
<!--/////////////////////////////////////////////////////////////////////////-->
<p class="subtitle">Concepts</p>
<p class="body">
Revisiting osg::Group<br>
Multiple Scenes
</p>
<!--/////////////////////////////////////////////////////////////////////////-->
<p class="subtitle">Revisiting osg::Group</p>
<p class="body">
We must remember when a child is attached to an <i>osg::Group</i> two links are
created: One going from the child to the parent, and one going from the parent
to the child. Adding children is easy, but what happens when we remove a child
from an <i>osg::Group</i>?
</p>
<center>
<table class="code">
<tbody><tr>
<td>
<p class="code">
osg::ref_ptr&lt;osg::Node&gt; somenode = new osg::Node();<br>
osg::ref_ptr&lt;osg::Group&gt; somegroup = new osg::Group();<br>
somegroup-&gt;addChild(somenode.get());<br>
...<br>
somegroup-&gt;removeChild(somenode.get());
</p>
</td>
</tr>
</tbody></table>
</center>
<p class="body">
As we would expect, the <i>osg::Group::removeChild()</i> function breaks the
link between both parent and child: <br>
1. The parent removes the child from the parent's list of children. <br>
2. The child loses one reference via the unref() function.<br>
IF ( number of references for the child &lt;= 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;child is deleted<br>
ELSE<br>
&nbsp;&nbsp;&nbsp;&nbsp;child deletes reference to parent
</p>
<!--/////////////////////////////////////////////////////////////////////////-->
<p class="subtitle">Multiple Scenes</p>
<p class="body">
    How does this help us? Remember that <i>Scene</i> contains an <i>osg::Group</i>
that acts as the root for the scene. This root is then attached directly to
the <i>osg::SceneView</i> in <i>Window</i> via the <i>osg::SceneView::setSceneData()</i>
function. In reality, the <i>osg::Group</i> is actually attached to an 
<i>osg::Camera</i> contained by the <i>osg::SceneView</i>.
</p>
<p class="body">
    The reason for explaining that detail is that <i>osg::Camera</i> is
derived class of <i>osg::Group</i>... meaning it can have children! Meaning
we can add and remove any children via the process described in the previous
section. Thus to change levels (scenes), the current scene (<i>osg::Group</i>)
must be removed from the game (<i>osg::Camera</i>), a new scene 
(<i>osg::Group</i>) must be created and then attached to the game 
(<i>osg::SceneView</i>). Demonstration:
</p>
<center>
<table class="code">
<tbody><tr>
<td>
<p class="code">
osg::ref_ptr&lt;osg::SceneView&gt; sceneview = new osg::SceneView();<br>
<br>
//Note that these groups represent 'scenes' of objects. Levels, if you will.<br>
osg::ref_ptr&lt;osg::Group&gt; firstlevel = new osg::Group();<br>
...<br>
//Attach the first level<br>
sceneview-&gt;setSceneData(firstlevel.get());<br>
...<br>
//Create a new scene (level)<br>
osg::ref_ptr&lt;osg::Group&gt; secondlevel = new osg::Group();<br>
...<br>
//Remove the first level from the parents. Note that the parent of this level<br>
//is actually the osg::Camera<br>
const vector&lt;osg::Group*&gt;&amp; parents = firstlevel-&gt;getParents();<br>
for(unsigned int i = 0; i &lt; parents.size(); ++i){<br>
&nbsp;&nbsp;&nbsp;&nbsp;osg::Group&amp; parent = *parents[i];<br>
&nbsp;&nbsp;&nbsp;&nbsp;parent.removeChild(firstlevel.get());<br>
}<br>
//Attach the second level<br>
sceneview-&gt;setSceneData(secondlevel.get());<br>
</p>
</td>
</tr>
</tbody></table>
</center>
<p class="body">
Note that for the tutorial code, the two classes of importance are <i>Scene</i>
and <i>System_Controller</i>.
</p>
<!--/////////////////////////////////////////////////////////////////////////-->
<p class="subtitle">Controls</p>
<p class="body">
The tutorial code can be manipulated via the following keyboard input:
</p>
<center>
<table class="code">
<tbody><tr>
<td>
<p class="code">
Esc - Exit<br>
1 - Change to a level with a single star<br>
2 - Change to a level with two stars<br>
3 - Change to a level with three stars<br>
</p>
</td>
</tr>
</tbody></table>
</center>
<!--/////////////////////////////////////////////////////////////////////////-->
<p class="subtitle">References</p>
<p class="body">
<a href="http://www.openscenegraph.org/documentation/OpenSceneGraphReferenceDocs/a01471.html">osg::SceneView</a><br>
<a href="http://www.openscenegraph.org/documentation/OpenSceneGraphReferenceDocs/a01059.html">osg::Camera</a><br>
<a href="http://www.openscenegraph.org/documentation/OpenSceneGraphReferenceDocs/a01220.html">osg::Group</a><br>
<a href="http://www.cs.clemson.edu/%7Emalloy/courses/3dgames-2007/tutor/web/levels/levels.tar.gz">Tutorial Code</a>
</p>
<!--/////////////////////////////////////////////////////////////////////////-->
<p class="subtitle">Conclusion</p>
<p class="body">
As can be noted, changing 'levels' is as easy as removing old objects from the scene and adding
new ones. However, one must be sure that the old objects are removed properly, so careful
use of ref_ptrs is well advised. 
</p>
<!--/////////////////////////////////////////////////////////////////////////-->
<p><br></p>
</td>
</tr>
</tbody></table>
</center>

</body></html>